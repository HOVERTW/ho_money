# 📤 上傳按鈕功能指南

## 🎯 功能概述

在儀表板的刪除鍵左邊新增了一個上傳按鈕，點擊後會觸發以下流程：

1. **檢查登錄狀態**
   - 如果用戶已登錄 → 直接進行 Supabase 同步
   - 如果用戶未登錄 → 顯示登錄模態

2. **登錄選項**
   - Google 登錄（一鍵登錄）
   - 電子郵件註冊/登錄

3. **自動同步**
   - 登錄成功後自動同步本地數據到 Supabase

## 🔧 實現的功能

### ✅ 上傳按鈕
- **位置**: 儀表板 header，刪除按鈕左邊
- **圖標**: 雲端上傳圖標 (`cloud-upload-outline`)
- **顏色**: 藍色主題 (`#007AFF`)

### ✅ 登錄模態
- **Google 登錄**: 使用 Supabase OAuth
- **電子郵件登錄**: 支援登錄和註冊
- **表單驗證**: 密碼長度、確認密碼等
- **錯誤處理**: 顯示詳細錯誤信息

### ✅ 認證狀態管理
- **Zustand Store**: 使用 `useAuthStore` 管理認證狀態
- **持久化**: 認證狀態在應用重啟後保持
- **自動登出**: 支援安全登出功能

### ✅ 同步功能
- **自動觸發**: 登錄成功後自動開始同步
- **進度提示**: 顯示同步開始和完成的提示
- **錯誤處理**: 同步失敗時顯示錯誤信息

## 🎨 UI/UX 設計

### 上傳按鈕樣式
```typescript
uploadButton: {
  padding: 8,
  borderRadius: 8,
  backgroundColor: '#F0F8FF',
  borderWidth: 1,
  borderColor: '#E5F3FF',
  alignItems: 'center',
  justifyContent: 'center',
}
```

### 登錄模態設計
- **響應式設計**: 適配不同螢幕尺寸
- **現代化 UI**: 圓角、陰影、漸變效果
- **直觀操作**: 清晰的按鈕和表單佈局

## 📱 使用流程

### 1. 未登錄用戶
1. 點擊上傳按鈕 → 顯示登錄模態
2. 選擇登錄方式：
   - **Google 登錄**: 點擊藍色 Google 按鈕
   - **電子郵件**: 輸入郵箱和密碼
3. 登錄成功 → 自動關閉模態並開始同步

### 2. 已登錄用戶
1. 點擊上傳按鈕 → 直接開始同步
2. 顯示同步進度提示
3. 同步完成後顯示成功信息

### 3. 註冊新用戶
1. 在登錄模態中點擊「沒有帳號？立即註冊」
2. 輸入郵箱和密碼（至少6個字符）
3. 確認密碼
4. 註冊成功後自動登錄並同步

## 🔒 安全特性

### 認證安全
- **Supabase Auth**: 使用業界標準的認證服務
- **OAuth 2.0**: Google 登錄使用安全的 OAuth 流程
- **密碼加密**: 密碼在傳輸和存儲時都經過加密

### 數據安全
- **API Key 保護**: 環境變數中的 API Key 不會暴露
- **HTTPS**: 所有數據傳輸都使用 HTTPS 加密
- **權限控制**: 用戶只能訪問自己的數據

## 🚀 技術實現

### 核心組件
- **DashboardScreen.tsx**: 主要實現文件
- **authStore.ts**: 認證狀態管理
- **supabase.ts**: 認證服務實現

### 關鍵函數
```typescript
// 上傳按鈕處理
const handleUploadClick = () => {
  if (user) {
    handleSyncToSupabase();
  } else {
    setShowLoginModal(true);
  }
};

// Google 登錄
const handleGoogleLogin = async () => {
  await signInWithGoogle();
  // 登錄成功後自動同步
};

// 同步到 Supabase
const handleSyncToSupabase = async () => {
  // 實際的同步邏輯
};
```

## 📋 待完善功能

### 🔄 同步邏輯
目前同步功能是模擬實現，需要添加實際的數據同步邏輯：
- 上傳本地資產數據
- 上傳交易記錄
- 上傳用戶設定
- 處理數據衝突

### 🔔 通知系統
- 同步進度通知
- 同步完成通知
- 錯誤通知

### 📊 同步狀態
- 顯示最後同步時間
- 顯示同步狀態（成功/失敗/進行中）
- 同步歷史記錄

## 🎉 測試指南

### 測試步驟
1. **啟動應用**: `npx expo start`
2. **打開 Web 版**: 訪問 http://localhost:8081
3. **測試上傳按鈕**: 點擊儀表板右上角的雲端圖標
4. **測試登錄流程**: 嘗試不同的登錄方式
5. **測試同步功能**: 登錄後測試自動同步

### 預期結果
- ✅ 上傳按鈕正確顯示
- ✅ 登錄模態正常彈出
- ✅ Google 登錄流程正常
- ✅ 電子郵件登錄/註冊正常
- ✅ 同步提示正確顯示

## 🔧 故障排除

### 常見問題
1. **Google 登錄失敗**: 檢查 OAuth 配置
2. **同步失敗**: 檢查網路連接和 API Key
3. **模態不顯示**: 檢查狀態管理

### 調試方法
- 查看瀏覽器控制台
- 檢查 Metro bundler 日誌
- 使用 React DevTools

---

**🎯 下一步**: 完善實際的數據同步邏輯，實現完整的雲端同步功能。
